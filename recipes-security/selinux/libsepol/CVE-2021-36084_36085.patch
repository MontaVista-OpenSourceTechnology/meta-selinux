libsepol/cil: Destroy classperm list when resetting map perms

Map perms share the same struct as regular perms, but only the
map perms use the classperms field. This field is a pointer to a
list of classperms that is created and added to when resolving
classmapping rules, so the map permission doesn't own any of the
data in the list and this list should be destroyed when the AST is
reset.

When resetting a perm, destroy the classperms list without destroying
the data in the list.

Signed-off-by: James Carter <jwcart2@gmail.com>

Upstream-Status: Backport
CVE: CVE-2021-36084
CVE: CVE-2021-36085
Signed-off-by: Armin Kuster <akuster@mvista.com>


Index: libsepol-2.8/cil/src/cil_reset_ast.c
===================================================================
--- libsepol-2.8.orig/cil/src/cil_reset_ast.c
+++ libsepol-2.8/cil/src/cil_reset_ast.c
@@ -52,7 +52,7 @@ static void cil_reset_classpermission(st
 		return;
 	}
 
-	cil_reset_classperms_list(cp->classperms);
+	cil_list_destroy(&cp->classperms, CIL_FALSE);
 }
 
 static void cil_reset_classperms_set(struct cil_classperms_set *cp_set)
